## PRD-016: User Onboarding with Driver.js - COMPLETE
- Installed driver.js package for interactive guided tours
- Created src/lib/guided-tour.ts with 10 tour steps covering all features
- Tour steps: Welcome, Sidebar, Sheet tabs, Add specs, Spreadsheet, Dropdowns, Import, Export, Settings, Completion
- Created hasTourCompleted(), markTourCompleted(), resetTourStatus() for localStorage persistence
- Created GuidedTourButton component with HelpCircle icon
- Added Tour button to app header between title and Import button
- Added data-tour attributes to: sidebar, add-spec-button, spreadsheet, import-button, export-button, settings-button
- Tour targets Fortune-Sheet CSS classes for tab container and cell area
- Added custom CSS styling for tour popover matching app theme
- 7 tests for guided-tour.ts, 6 tests for GuidedTourButton.tsx
- All feedback loops pass (232 tests, typecheck, lint)

Files created:
- src/lib/guided-tour.ts
- src/lib/guided-tour.test.ts
- src/components/GuidedTourButton.tsx
- src/components/GuidedTourButton.test.tsx

Files changed:
- src/components/AppLayout.tsx (added GuidedTourButton, data-tour attributes)
- src/components/SpreadsheetContainer.tsx (added data-tour attribute)
- src/components/SpecificationList.tsx (added data-tour attribute)
- src/index.css (driver.js popover styling)
- package.json (driver.js dependency)

## PRD-015: Move SKU Column to Column A - COMPLETE
- Moved SKU column from last position to first position (index 0)
- Updated extractColumnHeaders() in sheet-sku.ts to skip first column instead of last
- Updated getRowValuesWithoutSKU() to use slice(1) instead of slice(0, -1)
- Updated updateRowSKU() in auto-sku.ts to write SKU to row[0] instead of row[headers.length]
- Updated findChangedRows() to compare columns starting from index 1 (skip SKU column 0)
- Updated extractHeaders() in SpreadsheetContainer.tsx to skip first column
- Updated buildDataVerification() to apply dropdowns to columns 1+ (colIndex = headerIndex + 1)
- Updated all test files with new column order (SKU first)
- All feedback loops pass (219 tests, typecheck, lint)

Files changed:
- src/lib/sheet-sku.ts (extractColumnHeaders, getRowValuesWithoutSKU)
- src/lib/auto-sku.ts (updateRowSKU, findChangedRows)
- src/components/SpreadsheetContainer.tsx (extractHeaders, buildDataVerification)
- src/lib/sheet-sku.test.ts (updated test data for SKU-first order)
- src/lib/auto-sku.test.ts (updated test data for SKU-first order)
- src/lib/e2e-workflow.test.ts (updated test data for SKU-first order)
- src/components/SettingsDialog.test.tsx (updated test data for SKU-first order)

## PRD-014: Infinite Re-render Fix - COMPLETE
- Fixed 'Maximum update depth exceeded' error in SpreadsheetContainer
- Added isDataEqual helper for deep CellData[][] comparison
- Replaced sheetsRef useMemo with previousDataRef useRef (no render triggers)
- Added sheetsSnapshotRef useRef synced via useEffect for stable callback access
- Removed sheets dependency from handleBeforeDeleteSheet/handleBeforeUpdateSheetName
- handleChange now uses refs + isDataEqual check to skip unchanged data
- Memoized configSheet with useMemo finding config type sheet
- All feedback loops pass (219 tests, typecheck, lint)

Files changed:
- src/components/SpreadsheetContainer.tsx (refactored hooks/refs for stability)

## PRD-012: End-to-End Verification - COMPLETE
- Created comprehensive integration test suite (23 tests) verifying complete workflow
- Tests cover all PRD-012 steps: Config parsing, SKU generation, settings, export/import
- Step 1-3: Config sheet parsing correctly extracts Temperature, Color, Type specs
- Step 4: Data sheet headers (excluding SKU) extracted correctly for dropdown matching
- Step 5-6: SKU auto-generation "29C-R-STD" verified for selected values
- Step 7: SKU updates correctly when values change (Red->Blue = "29C-B-STD")
- Step 8: Export/import round-trip preserves Config and data sheet contents
- Settings variations tested: underscore delimiter, prefix/suffix, no delimiter
- Edge cases: partial rows, unknown values, empty rows
- Added Playwright E2E tests for browser-based testing (requires browser deps)
- Excluded e2e/ from vitest config to prevent conflicts
- All feedback loops pass (219 tests)

Files created:
- src/lib/e2e-workflow.test.ts (23 integration tests)
- e2e/complete-workflow.spec.ts (Playwright E2E test)
- playwright.config.ts

Files changed:
- package.json (added @playwright/test, test:e2e script)
- vitest.config.ts (exclude e2e directory)

## PRD-010: Import/Export - COMPLETE
- Created src/lib/import-export.ts with Excel and CSV support using xlsx library
- exportToExcel: exports all sheets (Config + data) to single .xlsx workbook
- exportToCSV: exports current sheet to CSV file
- importFromExcel: imports .xlsx file, detects Config sheet (case-insensitive)
- Config sheet always placed first on import/export
- Round-trip preserves data through export/import cycle
- Added Import/Export buttons to AppLayout header
- Import button with hidden file input for .xlsx/.xls files
- Export dropdown with Excel (.xlsx) and CSV options
- Import replaces all sheets with imported data
- Created dropdown-menu UI component for export options
- 13 tests: blob export, CSV string, import parsing, round-trip
- 4 AppLayout tests: import button, export button, dropdown behavior, file input
- All feedback loops pass (196 tests)

Files created:
- src/lib/import-export.ts
- src/lib/import-export.test.ts
- src/components/ui/dropdown-menu.tsx

Files changed:
- src/components/AppLayout.tsx (import/export buttons, file handling)
- src/components/AppLayout.test.tsx (+4 tests)
- package.json (xlsx dependency)

## PRD-013: Add Specification Dialog - COMPLETE
- Created AddSpecDialog component accessible from sidebar Add Specification button
- Form: spec name input + dynamic list of value/SKU code pairs
- Add Value button adds new entry, trash removes (min 1 entry required)
- Validation: spec name required, unique (case-insensitive), at least one value
- Submit adds rows to Config sheet for each value (spec name, value label, SKU code)
- Submit adds column to active data sheet (inserted before SKU column)
- Empty data sheets get header row created with new spec + SKU column
- Form resets on close, error messages shown inline
- Integrated into SpecificationList, replaced placeholder dialog
- 19 tests: render, inputs, validation, Config/data sheet updates, reset
- Updated SpecificationList test for new dialog behavior
- All feedback loops pass (179 tests)

Files created:
- src/components/AddSpecDialog.tsx
- src/components/AddSpecDialog.test.tsx

Files changed:
- src/components/SpecificationList.tsx (import & use AddSpecDialog)
- src/components/SpecificationList.test.tsx (updated test for new dialog)

## PRD-005: Sidebar Specification View - COMPLETE
- Rewrote SpecificationList to parse specs from Config sheet via parseConfigSheet()
- Read-only display: spec names with value counts, expandable to show values
- Edit button jumps to Config sheet (setActiveSheet)
- Add Specification button opens placeholder dialog that redirects to Config sheet
- Removed direct editing in sidebar - specs now edited only in Config sheet
- Sidebar auto-updates when Config sheet data changes (useMemo dependency)
- Removed old SpecificationItem.tsx and SpecificationForm.tsx (no longer needed)
- 12 new tests: empty state, display specs, value counts, expand/collapse, edit jump, dialog
- All feedback loops pass (160 tests)

Files changed:
- src/components/SpecificationList.tsx (complete rewrite)
- src/components/SpecificationList.test.tsx (complete rewrite)

Files removed:
- src/components/SpecificationItem.tsx
- src/components/SpecificationForm.tsx

## PRD-011: Settings Dialog - COMPLETE
- Created SettingsDialog component accessible from sidebar Settings button
- Delimiter options: Hyphen (-), Underscore (_), None, Custom with text input
- Prefix and suffix inputs for SKU customization
- Settings persist to localStorage via existing Zustand settings store
- Changing settings triggers SKU recalculation for all rows in all data sheets
- Uses isCustomMode state to track explicit custom delimiter selection
- 11 tests: dialog render, delimiter options, save/cancel, SKU recalculation
- All feedback loops pass (161 tests)

Files created:
- src/components/SettingsDialog.tsx
- src/components/SettingsDialog.test.tsx

Files changed:
- src/components/AppLayout.tsx (wired Settings button to open dialog)

## PRD-008: Multiple Sheets Support - COMPLETE
- Extended SpreadsheetContainer with Fortune-Sheet hooks for sheet management
- Config sheet protected: beforeDeleteSheet returns false for config type
- Config sheet rename blocked: beforeUpdateSheetName returns false for config type
- Data sheet rename synced: afterUpdateSheetName updates Zustand store
- New sheets synced: afterAddSheet adds Fortune-Sheet created sheets to Zustand
- Sheet deletion synced: afterDeleteSheet removes from Zustand store
- Added addSheetWithId to sheets store for external ID sheet creation
- Fortune-Sheet built-in UI handles: + button, double-click rename, X delete
- Config tab styled orange (#f97316), data tabs default color
- 10 new tests: 3 for addSheetWithId, 7 for SpreadsheetContainer hooks
- All feedback loops pass (150 tests)

Files changed:
- src/store/sheets.ts (addSheetWithId function)
- src/store/sheets.test.ts (+3 addSheetWithId tests)
- src/components/SpreadsheetContainer.tsx (hook handlers for sheet ops)
- src/components/SpreadsheetContainer.test.tsx (+7 hook tests)

## PRD-007: Auto SKU Generation - COMPLETE
- Created src/lib/auto-sku.ts with auto-SKU helper functions
- updateRowSKU: generates SKU for single row based on headers and Config specs
- findChangedRows: compares old/new data to detect which rows changed (excludes SKU col)
- processAutoSKU: orchestrates change detection and SKU updates
- SpreadsheetContainer handleChange now calls processAutoSKU for data sheets
- Fixed infinite loop: settings now selected as primitives then memoized
- Row values sliced based on header count, not row length (handles missing SKU col)
- 22 tests for auto-sku.ts covering edge cases and workflows
- Test: Select 'Red', 'Small' -> SKU shows 'R-S' ✓
- All feedback loops pass (140 tests)

Files created:
- src/lib/auto-sku.ts
- src/lib/auto-sku.test.ts

Files changed:
- src/components/SpreadsheetContainer.tsx (processAutoSKU integration, settings fix)

## PRD-006: Spreadsheet Integration - COMPLETE
- Created SpreadsheetContainer wrapping Fortune-Sheet Workbook component
- Parses Config sheet via parseConfigSheet to get spec names and allowed values
- buildDataVerification generates dropdown rules keyed by "row_col" format
- Column headers in data sheets match spec names to get dropdown options
- dataVerification objects created for all data rows per column matching a spec
- Workbook uses hooks.afterActivateSheet for sheet tab sync
- Config sheet styled with orange tab color (#f97316)
- onChange callback syncs Fortune-Sheet data back to Zustand store
- 8 tests: empty state, workbook rendering, sheet colors, tab display
- Updated App.tsx with SpreadsheetContainer + initializeWithConfigSheet on mount
- All feedback loops pass (118 tests)

Files created:
- src/components/SpreadsheetContainer.tsx
- src/components/SpreadsheetContainer.test.tsx

Files changed:
- src/App.tsx (SpreadsheetContainer integration, Config init)
- src/App.test.tsx (Fortune-Sheet mock to avoid canvas errors)

## PRD-004: SKU Generation Logic (Config Sheet Approach) - COMPLETE
- Created config-sheet.ts: parseConfigSheet extracts ParsedSpec[] from Config sheet data
- getSpecValues returns values for a spec name, lookupSkuCode finds SKU code for spec+value
- getSpecNames helper returns all spec names
- Created sheet-sku.ts: generateRowSKU takes row values, column headers, parsed config, settings
- extractColumnHeaders gets headers excluding last column (SKU column)
- getRowValuesWithoutSKU slices row to exclude SKU column
- 19 tests for config-sheet.ts: parsing, grouping, empty handling, whitespace trim
- 22 tests for sheet-sku.ts: basic gen, delimiter/prefix/suffix, edge cases
- Test: Row 'Red','Small' with headers 'Color','Size' -> 'R-S' ✓
- All feedback loops pass (110 tests)

Files created:
- src/lib/config-sheet.ts
- src/lib/config-sheet.test.ts
- src/lib/sheet-sku.ts
- src/lib/sheet-sku.test.ts

## PRD-003: State Management (Config Sheet Approach) - COMPLETE
- Updated sheets.ts: Config sheet as first sheet with headers (Specification, Value, SKU Code)
- Added initializeWithConfigSheet() to create Config sheet on app start
- Added getConfigSheet() helper to retrieve Config sheet
- Config sheet protected from deletion (removeSheet returns false)
- Deprecated specifications.ts with notice - specs now live in Config sheet
- Data sheet naming excludes Config from count (Sheet 1, Sheet 2...)
- 7 new tests: initializeWithConfigSheet, getConfigSheet, Config protection
- All feedback loops pass (69 tests)

Files changed:
- src/store/sheets.ts (Config sheet init, protection, getConfigSheet)
- src/store/sheets.test.ts (+7 new tests)
- src/store/specifications.ts (added deprecation notice)

## PRD-002: Data Model (Config Sheet Approach) - COMPLETE
- Updated src/types/index.ts for Config sheet-based spec management
- ConfigRow: interface for Config sheet rows (specification, value, skuCode)
- ParsedSpec + ParsedSpecValue: parsed specs grouped by name
- SheetConfig: added 'type' field (SheetType = 'config' | 'data')
- AppSettings: unchanged (delimiter, prefix, suffix)
- CellData: unchanged (Fortune-Sheet cell format)
- SelectedValues: Map<string, string> - now maps spec name to value label
- Kept legacy Specification/SpecValue interfaces with @deprecated for migration
- Updated sheets.ts createEmptySheet to accept type parameter

Files changed:
- src/types/index.ts
- src/store/sheets.ts (type field fix)

All feedback loops pass (62 tests)

## PRD-005: Specification Management UI - COMPLETE
- Created SpecificationList component with Framer Motion Reorder for drag-reorder
- Created SpecificationItem with expand/collapse animations (ChevronDown rotation)
- SpecificationForm dialog for add/edit spec name
- Inline SpecValueForm within SpecificationItem for adding label+skuCode pairs
- Drag handle uses useDragControls for pointer-based reordering
- AnimatePresence for smooth add/remove animations on specs and values
- Delete confirmation via direct button (no dialog - per minimalism)
- 13 tests covering: empty state, add spec, edit spec, delete spec, add value, delete value, expand/collapse, value count, keyboard interactions
- All feedback loops pass (62 total tests)

Files created:
- src/components/SpecificationList.tsx
- src/components/SpecificationItem.tsx
- src/components/SpecificationForm.tsx
- src/components/SpecificationList.test.tsx

Files changed:
- src/App.tsx (integrated SpecificationList in sidebar)
- src/test/setup.ts (added scrollTo mock for framer-motion)
- package.json (@testing-library/user-event added)

## PRD-009: App Layout - COMPLETE
- Created AppLayout component with shadcn/ui SidebarProvider
- Left sidebar: header with "Specifications" title, content slot, Settings button footer
- Main area: SidebarInset with header (title + toggle) and main content slot
- Sidebar uses collapsible="offcanvas" mode for collapse/expand
- Header includes SidebarTrigger for toggle + app title "SKU Generator"
- Added matchMedia mock to test setup for jsdom compatibility
- 6 tests covering: header, sidebar, content slots, settings button, toggle
- All feedback loops pass (49 total tests)

Files created/changed:
- src/components/AppLayout.tsx
- src/components/AppLayout.test.tsx
- src/App.tsx (updated to use AppLayout)
- src/test/setup.ts (added matchMedia mock)

## PRD-004: SKU Generation Logic - COMPLETE
- Created generateSKU function in src/lib/sku-generator.ts
- Takes: selectedValues (Map<specId,label>), specifications[], settings
- Looks up skuCode for each selected label in spec values
- Sorts by columnIndex for consistent ordering
- Joins codes with configurable delimiter, prefix, suffix
- Returns empty string if no values selected
- 13 tests covering: basic generation, column ordering, custom delimiter, prefix/suffix, edge cases
- Test: Temperature='29deg C' (29C) + Color='Red' (R) = '29C-R' ✓
- All feedback loops pass (43 total tests)

Files created:
- src/lib/sku-generator.ts
- src/lib/sku-generator.test.ts

## PRD-003: State Management - COMPLETE
- Created Zustand stores with localStorage persistence
- specifications.ts: CRUD for specs and values, reorder, columnIndex recalc
- sheets.ts: multi-sheet management, activeSheetId, cell updates
- settings.ts: delimiter, prefix, suffix config
- localStorage keys: sku-specifications, sku-sheets, sku-settings
- 30 tests passing (10 specs, 12 sheets, 7 settings + 1 app)

Files created:
- src/store/index.ts
- src/store/specifications.ts + .test.ts
- src/store/sheets.ts + .test.ts
- src/store/settings.ts + .test.ts

## PRD-002: Data Model - COMPLETE
- Created src/types/index.ts with all required interfaces
- SpecValue: id, label, skuCode
- Specification: id, name, values[], columnIndex
- SheetConfig: id, name, data[][] for multi-sheet support
- CellData: Fortune-Sheet cell structure (v, m, ct)
- AppSettings: delimiter, prefix, suffix for SKU config
- SelectedValues: Map<string, string> type alias
- All feedback loops pass

Files created:
- src/types/index.ts

## PRD-001: Project Setup - COMPLETE
- Initialized React+Vite+TypeScript project manually (Vite CLI had permission issues)
- Installed: zustand, framer-motion, @fortune-sheet/react@1.0.4, tailwindcss, shadcn/ui deps
- Configured: tailwind.config.js, postcss.config.js with shadcn theme vars
- Added shadcn/ui components: button, card, dialog, input, label, tabs, separator, tooltip, sidebar
- Created use-mobile hook for sidebar responsiveness
- Setup vitest with jsdom + testing-library
- All feedback loops pass: typecheck, lint (warnings only), test

Files created/changed:
- package.json, tsconfig.json, tsconfig.node.json, vite.config.ts
- tailwind.config.js, postcss.config.js, eslint.config.js
- index.html, src/main.tsx, src/App.tsx, src/index.css, src/vite-env.d.ts
- src/lib/utils.ts
- src/components/ui/*.tsx (button, card, dialog, input, label, tabs, separator, tooltip, sidebar)
- src/hooks/use-mobile.tsx
- vitest.config.ts, src/test/setup.ts, src/App.test.tsx

