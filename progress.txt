## sidebar-ui-3: Inline editing for specification values in sidebar

**Completed**: Users can click on spec values to edit displayValue and skuFragment inline

**Key decisions**:
- Created `SpecValueItem` component within SpecificationList.tsx
- Click on value triggers edit mode with two inputs (displayValue + skuFragment)
- Pre-fills inputs with current values
- Save via checkmark button or Enter key, cancel via X button or Escape
- Validates skuFragment uniqueness within spec before saving
- Shows error message below inputs if duplicate skuFragment detected
- Error clears automatically when skuFragment input changes
- Uses existing `updateSpecValue` store action (returns false on duplicate)
- SKU updates happen automatically via existing `useSkuReactivity` hook

**Files changed**:
- src/components/SpecificationList.tsx: Added SpecValueItem with edit form, validation
- src/components/SpecificationList.test.tsx: Added 9 tests for inline editing

---

## reactivity-1: Auto-regenerate SKUs when skuFragment changes

**Completed**: SKUs automatically regenerate when any skuFragment is changed in the specifications store

**Key decisions**:
- Created `useSkuReactivity` hook that subscribes to specification changes
- Uses useRef to track previous specifications and detect skuFragment changes
- `hasSkuFragmentChanged` helper compares valueId->skuFragment maps between renders
- Reuses existing `updateRowSKU` from auto-sku.ts for SKU regeneration
- Hook called at App component level to enable app-wide SKU reactivity
- Only triggers when skuFragment changes, not when displayValue changes (per PRD)

**Files changed**:
- src/lib/use-sku-reactivity.ts: New hook for SKU reactivity on spec changes
- src/lib/use-sku-reactivity.test.ts: 9 tests covering all scenarios
- src/App.tsx: Added useSkuReactivity() hook call

---

## sidebar-ui-2: Add drag-and-drop reordering to SpecificationList

**Completed**: Specifications can now be reordered via drag-and-drop in the sidebar

**Key decisions**:
- Used framer-motion's `Reorder.Group` and `Reorder.Item` components (already in project)
- Added `GripVertical` drag handle icon to each spec item
- Used local state (`localOrder`) during drag to avoid store updates until drag ends
- On drag end: calls `reorderSpec` for moved items, then regenerates all SKUs
- `regenerateAllSKUs` iterates all data sheets and calls `updateRowSKU` for each row
- Syncs local state with store when specifications change (via useEffect)

**Files changed**:
- src/components/SpecificationList.tsx: Added Reorder components, drag handles, reorder logic
- src/components/SpecificationList.test.tsx: Added 5 tests for drag-and-drop behavior

---

## readonly-sku-1: Make SKU column (column 0) read-only in data sheets

**Completed**: Column 0 is now read-only; users cannot manually edit SKU values

**Key decisions**:
- Added `config.colReadOnly: { 0: 1 }` to each sheet's Fortune-Sheet config
- Added `beforeUpdateCell` hook that returns false for column 0 (row > 0)
- Header row (row 0) remains editable for renaming "SKU" header
- Auto-generated SKUs via processAutoSKU still work (happens before Fortune-Sheet sees data)
- Copy from SKU cells works (read-only doesn't block selection/copy)

**Files changed**:
- src/components/SpreadsheetContainer.tsx: Added colReadOnly config, beforeUpdateCell hook
- src/components/SpreadsheetContainer.test.tsx: Added 6 tests for read-only behavior

---

## sku-gen-2: Update auto-SKU logic to use specifications from store

**Completed**: processAutoSKU now reads specifications from useSpecificationsStore

**Key decisions**:
- Changed processAutoSKU call in SpreadsheetContainer to pass actual specifications instead of empty array
- Added specifications to handleChange callback dependency array for proper reactivity
- Removed TODO comment about this task

**Files changed**:
- src/components/SpreadsheetContainer.tsx: Pass specifications to processAutoSKU, add to deps
- src/components/SpreadsheetContainer.test.tsx: Added 2 tests for SKU generation using store specs

---

## sku-gen-1: Modify generateRowSKU to accept Specification[] and sort by order

**Completed**: generateRowSKU now uses Specification[] and sorts by order field

**Key decisions**:
- Changed generateRowSKU signature: ParsedSpec[] → Specification[]
- Added buildHeaderValueMap helper to map column headers to cell values
- Sort specifications by order field before building SKU
- Column order in data sheet no longer affects SKU composition
- SKU fragments use spec order, not column position
- Updated auto-sku.ts: updateRowSKU/processAutoSKU now use Specification[]
- Updated SettingsDialog to use specifications store instead of Config sheet

**Files changed**:
- src/lib/sheet-sku.ts: Changed to accept Specification[], sort by order
- src/lib/sheet-sku.test.ts: Updated tests for new type, added order independence tests
- src/lib/auto-sku.ts: Changed ParsedSpec[] to Specification[]
- src/lib/auto-sku.test.ts: Updated tests for Specification type
- src/lib/e2e-workflow.test.ts: Updated to use Specification[] for generateRowSKU
- src/components/SettingsDialog.tsx: Use specifications store for SKU recalculation
- src/components/SettingsDialog.test.tsx: Updated tests to use specifications store

---

## sidebar-ui-4: Update AddSpecDialog to work with specifications store

**Completed**: AddSpecDialog now writes to useSpecificationsStore instead of Config sheet

**Key decisions**:
- Replaced getConfigSheet/parseConfigSheet with useSpecificationsStore hook
- Calls addSpecification(name) then addSpecValue() for each value
- Store auto-assigns order = max existing order + 1 for new specs
- Updated internal ValueEntry type: label→displayValue, skuCode→skuFragment
- Removed Config sheet write logic, kept data sheet column addition
- Updated dialog description text (no longer mentions Config sheet)
- existingSpecNames validation now reads from specifications array

**Files changed**:
- src/components/AddSpecDialog.tsx: Replaced Config sheet with specifications store
- src/components/AddSpecDialog.test.tsx: Rewrote 20 tests to use specifications store

---

## sidebar-ui-1: Enhance SpecificationList to read from useSpecificationsStore

**Completed**: SpecificationList now reads from useSpecificationsStore instead of Config sheet

**Key decisions**:
- Replaced useSheetsStore/parseConfigSheet with useSpecificationsStore hook
- Updated SpecItem to accept Specification type (not ParsedSpec)
- Changed field references: displayValue (was label), skuFragment (was skuCode)
- Specs sorted by order field (lowest first) via useMemo
- Removed "Edit" button that jumped to Config sheet (no longer applicable)
- Updated empty state message: "Click Add Specification to create one"
- Keys now use spec.id and value.id instead of name/index

**Files changed**:
- src/components/SpecificationList.tsx: Replaced Config sheet parsing with store hook
- src/components/SpecificationList.test.tsx: Rewrote 12 tests to use specifications store

---

## remove-config-3: Update dropdown building to use specifications store

**Completed**: Dropdowns now built from useSpecificationsStore instead of Config sheet

**Key decisions**:
- Added extractHeaders() helper to get column names from first row
- Added buildDataVerification() to create Fortune-Sheet dropdown config
- dataVerification keyed by "{row}_{col}", applies dropdown to rows 1-99 in matching columns
- Column matched by header name === specification.name
- Dropdown value1 = comma-separated displayValues from spec
- Empty specs or specs with no values gracefully handled (no dropdown)
- Component re-renders when specifications change (specs in dependency array)

**Files changed**:
- src/components/SpreadsheetContainer.tsx: Added buildDataVerification, extractHeaders, useSpecificationsStore
- src/components/SpreadsheetContainer.test.tsx: Added 6 tests for dropdown building behavior

---

## remove-config-2: Remove Config sheet handling from SpreadsheetContainer

**Completed**: SpreadsheetContainer no longer references config-sheet.ts or Config sheet type

**Key decisions**:
- Removed imports: parseConfigSheet, getSpecValues from config-sheet.ts
- Removed configSheet and parsedSpecs memos
- Removed beforeDeleteSheet/beforeUpdateSheetName hooks (no more Config protection)
- Removed sheet.type === 'config' checks in onChange handler
- Removed orange color styling for Config sheet
- Removed buildDataVerification and extractHeaders (dropdown building deferred to remove-config-3)
- processAutoSKU now passes empty specs array (to be fixed in sku-gen-2)
- Added TODO comments for remove-config-3 and sku-gen-2 follow-up tasks

**Files changed**:
- src/components/SpreadsheetContainer.tsx: Removed all Config sheet references
- src/components/SpreadsheetContainer.test.tsx: Updated tests for new behavior

---

## remove-config-1: Remove Config sheet from initialization

**Completed**: Config sheet no longer created on first launch; specs go to store

**Key decisions**:
- initializeWithSampleData() creates only Sample Products data sheet (no Config)
- getSampleSpecifications() returns Specification[] with Color/Size/Material
- Sample specs added directly to useSpecificationsStore on first launch
- onRehydrateStorage also updated to use new pattern
- Legacy createSampleSheets() kept with @deprecated for migration task

**Files changed**:
- src/lib/sample-data.ts: Added getSampleSpecifications(), createSampleProductSheet()
- src/store/sheets.ts: Updated initializeWithSampleData() and onRehydrateStorage
- src/lib/sample-data.test.ts: Added tests for getSampleSpecifications()
- src/store/sheets.test.ts: Updated tests for new behavior (no Config sheet)

---

## spec-store-3: Add skuFragment uniqueness validation

**Completed**: Added validateSkuFragment selector and enforced uniqueness

**Key decisions**:
- validateSkuFragment(specId, skuFragment, excludeValueId?) returns true if unique
- addSpecValue returns null if duplicate skuFragment in same spec
- updateSpecValue returns false if would create duplicate
- Different specs can share same skuFragment (Color:R and Size:R allowed)

**Files changed**:
- src/store/specifications.ts: Added validateSkuFragment, updated addSpecValue/updateSpecValue
- src/store/specifications.test.ts: Added 9 new tests for validation

---

## spec-store-2: Revive useSpecificationsStore as single source of truth

**Completed**: Store already fully implemented in spec-store-1

**Key decisions**:
- All requirements met: addSpecification, updateSpecification, removeSpecification, reorderSpec actions
- reorderSpec properly shifts other specs' orders for contiguity
- Persists to localStorage with key 'sku-specifications'
- 14 store tests all pass

**Files changed**: None (already complete from spec-store-1)

---

## spec-store-1: Update Specification type with order field

**Completed**: Updated data model types and specifications store

**Key decisions**:
- Renamed SpecValue fields: label→displayValue, skuCode→skuFragment (per PRD)
- Replaced Specification.columnIndex with order field
- Removed @deprecated markers from Specification/SpecValue (now primary interfaces)
- Store auto-assigns order=max+1 for new specs
- reorderSpec(specId, newOrder) shifts other specs' orders to maintain contiguity

**Files changed**:
- src/types/index.ts: Updated Specification & SpecValue interfaces
- src/store/specifications.ts: Removed deprecated status, added reorderSpec action
- src/store/specifications.test.ts: Updated tests for new field names, added reorderSpec tests
- src/lib/sku-generator.ts: Updated to use order/displayValue/skuFragment
- src/lib/sku-generator.test.ts: Updated test fixtures for new field names

**Notes**: Kept ParsedSpec/ParsedSpecValue/ConfigRow for backwards compat during migration
