## sheet-headers-1: Initialize new sheets with proper headers

**Completed**: New data sheets now initialize with SKU and spec headers in row 0

**Key decisions**:
- Created `createHeaderRow()` helper in sheets.ts that reads specs from store
- Specs sorted by `order` field before adding to header row
- Header row format: ['SKU', spec1.name, spec2.name, ...]
- Both `addSheet()` and `addSheetWithId()` now use `createHeaderRow()`
- Empty specs result in header row with only 'SKU'
- Non-data sheets (type !== 'data') still get empty data array

**Files changed**:
- src/store/sheets.ts: Added createHeaderRow(), modified createEmptySheet() and addSheetWithId()
- src/store/sheets.test.ts: Updated existing test, added 2 new tests for header initialization

---

## migration-1: Config sheet to specifications store migration

**Completed**: Automatic migration of Config sheet data to specifications store on app load

**Key decisions**:
- Created migration.ts module with convertParsedSpecsToSpecifications and migrateConfigSheetData functions
- Migration runs in onRehydrateStorage callback (Zustand persist) after state is hydrated
- Migration only triggers when: Config sheet exists AND specifications store is empty
- Reuses parseConfigSheet from deprecated config-sheet.ts to parse Config data
- ParsedSpec[] -> Specification[] conversion assigns sequential order values (0, 1, 2...)
- Config sheet is removed from sheets array after successful migration
- activeSheetId updated to first data sheet if it was pointing to Config
- Data sheets remain intact with their original data

**Files changed**:
- src/lib/migration.ts: New module with Config sheet migration functions
- src/lib/migration.test.ts: 10 tests covering conversion and migration scenarios
- src/store/sheets.ts: Added migration logic to onRehydrateStorage callback
- src/store/sheets.test.ts: Added 5 integration tests for Config sheet migration

---

## cleanup-1: Deprecate config-sheet.ts and related utilities

**Completed**: config-sheet.ts and related functions marked as @deprecated with JSDoc comments

**Key decisions**:
- Did NOT delete config-sheet.ts since migration-1 task needs parseConfigSheet to migrate existing users' Config sheet data
- Marked all functions in config-sheet.ts with @deprecated JSDoc comments
- Marked getConfigSheet and initializeWithConfigSheet in sheets.ts as @deprecated
- Updated test file describe() names to include "(deprecated - for migration)" suffix
- Added header comment to e2e-workflow.test.ts explaining migration purpose
- All deprecation notices reference migration-1 task and prd.json

**Files changed**:
- src/lib/config-sheet.ts: Added @deprecated module and function comments
- src/lib/config-sheet.test.ts: Added deprecation comment, renamed describe blocks
- src/store/sheets.ts: Added @deprecated to getConfigSheet, initializeWithConfigSheet, CONFIG_SHEET_HEADERS, createConfigSheet
- src/store/sheets.test.ts: Renamed 3 describe blocks to indicate deprecation
- src/lib/e2e-workflow.test.ts: Added header comment explaining migration context

---

## reactivity-3: Update cells when displayValue renamed

**Completed**: Cells automatically update when a displayValue is renamed in the specifications store

**Key decisions**:
- Extended `useSkuReactivity` hook to detect displayValue changes (not just skuFragment)
- `getDisplayValueChanges` helper compares valueId->displayValue maps between renders
- `updateDisplayValuesInSheets` finds cells with old value in matching spec column and updates them
- Only updates cells in columns where header matches specification name
- Header row (row 0) is never modified
- SKUs remain unchanged (displayValue change does not trigger SKU regeneration)
- Multiple sheets are updated in a single pass

**Files changed**:
- src/lib/use-sku-reactivity.ts: Added getDisplayValueChanges, updateDisplayValuesInSheets functions
- src/lib/use-sku-reactivity.test.ts: Added 5 new tests for displayValue reactivity, updated 1 existing test

---

## validation-3: ValidationPanel component for error display

**Completed**: ValidationPanel component displays validation errors below spreadsheet with click-to-navigate

**Key decisions**:
- Created ValidationPanel component that shows error count, type summary, and list of errors
- Panel uses amber color scheme for duplicate SKU warnings, red for missing value errors
- Error items are clickable and trigger navigation to affected cell in spreadsheet
- Uses Fortune-Sheet's WorkbookInstance ref with setSelection() and scroll() APIs for cell navigation
- Panel hides automatically when no errors exist
- Computes errors from active sheet only (via activeSheetId)
- Both validateDataSheet and findDuplicateSKUs results combined for comprehensive error list

**Files changed**:
- src/components/ValidationPanel.tsx: New component with error display, click handlers, animations
- src/components/ValidationPanel.test.tsx: 17 tests covering all functionality
- src/components/SpreadsheetContainer.tsx: Integrated ValidationPanel, added workbookRef, handleErrorClick
- src/components/SpreadsheetContainer.test.tsx: Added 6 tests for ValidationPanel integration

---

## validation-2: Duplicate SKU detection

**Completed**: findDuplicateSKUs function detects rows with duplicate SKU values and highlights them

**Key decisions**:
- Extended ValidationError type to include 'duplicate-sku' as a type
- findDuplicateSKUs builds map of SKU value -> row indices, flags all rows with non-unique SKUs
- Error message includes all row numbers sharing the same SKU for easy identification
- Empty/whitespace-only SKU cells are not considered duplicates (skipped)
- Whitespace trimmed before comparison for consistent matching
- SpreadsheetContainer highlights duplicate SKU cells with amber background (#fef3c7)
- Non-duplicate SKU cells keep the standard read-only background (#f1f5f9)

**Files changed**:
- src/lib/validation.ts: Added 'duplicate-sku' to ValidationError type, added findDuplicateSKUs function
- src/lib/validation.test.ts: Added 11 tests for duplicate SKU detection
- src/components/SpreadsheetContainer.tsx: Added duplicate highlighting via findDuplicateSKUs, DUPLICATE_SKU_BG_COLOR constant
- src/components/SpreadsheetContainer.test.tsx: Added 7 tests for duplicate SKU highlighting

---

## validation-1: Create validation module to detect deleted values

**Completed**: validateDataSheet function detects cells with values no longer in their specification

**Key decisions**:
- Created ValidationError interface with row, column, message, type fields
- type field is 'missing-value' for now (other validation types will be added later)
- Function maps column headers to specification names to determine which spec governs each column
- Columns not matching any spec name are ignored (non-spec columns like "Notes" won't error)
- Empty cells are always valid (no value to validate)
- Whitespace is trimmed from cell values before comparison

**Files changed**:
- src/lib/validation.ts: New module with validateDataSheet function, ValidationError type
- src/lib/validation.test.ts: 13 tests covering all validation scenarios

---

## reactivity-2: SKU regeneration on specification order change

**Completed**: SKUs regenerate with new fragment order when specs are reordered via drag-and-drop

**Key decisions**:
- Verified existing implementation in SpecificationList.tsx handles this correctly
- `handleDragEnd` calls `reorderSpec` for moved specs, then `regenerateAllSKUs`
- `regenerateAllSKUs` iterates all data sheets and calls `updateRowSKU` for each row
- `generateRowSKU` sorts specs by order field before building SKU fragment string
- Added explicit test verifying SKU changes from "R-S" to "S-R" when Size moved before Color

**Files changed**:
- src/components/SpecificationList.test.tsx: Added test "regenerates SKUs after reorder with correct fragment order"

---

## readonly-sku-2: Visual styling for read-only SKU column

**Completed**: SKU column (column 0) now has distinct visual styling to indicate it's auto-generated

**Key decisions**:
- Added subtle gray-blue background color (#f1f5f9) to SKU column data cells
- Header row (row 0) remains unstyled to maintain visual hierarchy
- Background color applied via Fortune-Sheet's cell `bg` property
- Empty cells in SKU column also get background color for consistency
- Color matches app's secondary/muted color scheme for cohesive design

**Files changed**:
- src/types/index.ts: Added `bg` property to CellData interface
- src/components/SpreadsheetContainer.tsx: Added SKU_COLUMN_BG_COLOR constant, updated convertToFortuneSheetData to apply bg to column 0 data cells
- src/components/SpreadsheetContainer.test.tsx: Added 5 tests for SKU column visual styling

---

## sidebar-ui-3: Inline editing for specification values in sidebar

**Completed**: Users can click on spec values to edit displayValue and skuFragment inline

**Key decisions**:
- Created `SpecValueItem` component within SpecificationList.tsx
- Click on value triggers edit mode with two inputs (displayValue + skuFragment)
- Pre-fills inputs with current values
- Save via checkmark button or Enter key, cancel via X button or Escape
- Validates skuFragment uniqueness within spec before saving
- Shows error message below inputs if duplicate skuFragment detected
- Error clears automatically when skuFragment input changes
- Uses existing `updateSpecValue` store action (returns false on duplicate)
- SKU updates happen automatically via existing `useSkuReactivity` hook

**Files changed**:
- src/components/SpecificationList.tsx: Added SpecValueItem with edit form, validation
- src/components/SpecificationList.test.tsx: Added 9 tests for inline editing

---

## reactivity-1: Auto-regenerate SKUs when skuFragment changes

**Completed**: SKUs automatically regenerate when any skuFragment is changed in the specifications store

**Key decisions**:
- Created `useSkuReactivity` hook that subscribes to specification changes
- Uses useRef to track previous specifications and detect skuFragment changes
- `hasSkuFragmentChanged` helper compares valueId->skuFragment maps between renders
- Reuses existing `updateRowSKU` from auto-sku.ts for SKU regeneration
- Hook called at App component level to enable app-wide SKU reactivity
- Only triggers when skuFragment changes, not when displayValue changes (per PRD)

**Files changed**:
- src/lib/use-sku-reactivity.ts: New hook for SKU reactivity on spec changes
- src/lib/use-sku-reactivity.test.ts: 9 tests covering all scenarios
- src/App.tsx: Added useSkuReactivity() hook call

---

## sidebar-ui-2: Add drag-and-drop reordering to SpecificationList

**Completed**: Specifications can now be reordered via drag-and-drop in the sidebar

**Key decisions**:
- Used framer-motion's `Reorder.Group` and `Reorder.Item` components (already in project)
- Added `GripVertical` drag handle icon to each spec item
- Used local state (`localOrder`) during drag to avoid store updates until drag ends
- On drag end: calls `reorderSpec` for moved items, then regenerates all SKUs
- `regenerateAllSKUs` iterates all data sheets and calls `updateRowSKU` for each row
- Syncs local state with store when specifications change (via useEffect)

**Files changed**:
- src/components/SpecificationList.tsx: Added Reorder components, drag handles, reorder logic
- src/components/SpecificationList.test.tsx: Added 5 tests for drag-and-drop behavior

---

## readonly-sku-1: Make SKU column (column 0) read-only in data sheets

**Completed**: Column 0 is now read-only; users cannot manually edit SKU values

**Key decisions**:
- Added `config.colReadOnly: { 0: 1 }` to each sheet's Fortune-Sheet config
- Added `beforeUpdateCell` hook that returns false for column 0 (row > 0)
- Header row (row 0) remains editable for renaming "SKU" header
- Auto-generated SKUs via processAutoSKU still work (happens before Fortune-Sheet sees data)
- Copy from SKU cells works (read-only doesn't block selection/copy)

**Files changed**:
- src/components/SpreadsheetContainer.tsx: Added colReadOnly config, beforeUpdateCell hook
- src/components/SpreadsheetContainer.test.tsx: Added 6 tests for read-only behavior

---

## sku-gen-2: Update auto-SKU logic to use specifications from store

**Completed**: processAutoSKU now reads specifications from useSpecificationsStore

**Key decisions**:
- Changed processAutoSKU call in SpreadsheetContainer to pass actual specifications instead of empty array
- Added specifications to handleChange callback dependency array for proper reactivity
- Removed TODO comment about this task

**Files changed**:
- src/components/SpreadsheetContainer.tsx: Pass specifications to processAutoSKU, add to deps
- src/components/SpreadsheetContainer.test.tsx: Added 2 tests for SKU generation using store specs

---

## sku-gen-1: Modify generateRowSKU to accept Specification[] and sort by order

**Completed**: generateRowSKU now uses Specification[] and sorts by order field

**Key decisions**:
- Changed generateRowSKU signature: ParsedSpec[] → Specification[]
- Added buildHeaderValueMap helper to map column headers to cell values
- Sort specifications by order field before building SKU
- Column order in data sheet no longer affects SKU composition
- SKU fragments use spec order, not column position
- Updated auto-sku.ts: updateRowSKU/processAutoSKU now use Specification[]
- Updated SettingsDialog to use specifications store instead of Config sheet

**Files changed**:
- src/lib/sheet-sku.ts: Changed to accept Specification[], sort by order
- src/lib/sheet-sku.test.ts: Updated tests for new type, added order independence tests
- src/lib/auto-sku.ts: Changed ParsedSpec[] to Specification[]
- src/lib/auto-sku.test.ts: Updated tests for Specification type
- src/lib/e2e-workflow.test.ts: Updated to use Specification[] for generateRowSKU
- src/components/SettingsDialog.tsx: Use specifications store for SKU recalculation
- src/components/SettingsDialog.test.tsx: Updated tests to use specifications store

---

## sidebar-ui-4: Update AddSpecDialog to work with specifications store

**Completed**: AddSpecDialog now writes to useSpecificationsStore instead of Config sheet

**Key decisions**:
- Replaced getConfigSheet/parseConfigSheet with useSpecificationsStore hook
- Calls addSpecification(name) then addSpecValue() for each value
- Store auto-assigns order = max existing order + 1 for new specs
- Updated internal ValueEntry type: label→displayValue, skuCode→skuFragment
- Removed Config sheet write logic, kept data sheet column addition
- Updated dialog description text (no longer mentions Config sheet)
- existingSpecNames validation now reads from specifications array

**Files changed**:
- src/components/AddSpecDialog.tsx: Replaced Config sheet with specifications store
- src/components/AddSpecDialog.test.tsx: Rewrote 20 tests to use specifications store

---

## sidebar-ui-1: Enhance SpecificationList to read from useSpecificationsStore

**Completed**: SpecificationList now reads from useSpecificationsStore instead of Config sheet

**Key decisions**:
- Replaced useSheetsStore/parseConfigSheet with useSpecificationsStore hook
- Updated SpecItem to accept Specification type (not ParsedSpec)
- Changed field references: displayValue (was label), skuFragment (was skuCode)
- Specs sorted by order field (lowest first) via useMemo
- Removed "Edit" button that jumped to Config sheet (no longer applicable)
- Updated empty state message: "Click Add Specification to create one"
- Keys now use spec.id and value.id instead of name/index

**Files changed**:
- src/components/SpecificationList.tsx: Replaced Config sheet parsing with store hook
- src/components/SpecificationList.test.tsx: Rewrote 12 tests to use specifications store

---

## remove-config-3: Update dropdown building to use specifications store

**Completed**: Dropdowns now built from useSpecificationsStore instead of Config sheet

**Key decisions**:
- Added extractHeaders() helper to get column names from first row
- Added buildDataVerification() to create Fortune-Sheet dropdown config
- dataVerification keyed by "{row}_{col}", applies dropdown to rows 1-99 in matching columns
- Column matched by header name === specification.name
- Dropdown value1 = comma-separated displayValues from spec
- Empty specs or specs with no values gracefully handled (no dropdown)
- Component re-renders when specifications change (specs in dependency array)

**Files changed**:
- src/components/SpreadsheetContainer.tsx: Added buildDataVerification, extractHeaders, useSpecificationsStore
- src/components/SpreadsheetContainer.test.tsx: Added 6 tests for dropdown building behavior

---

## remove-config-2: Remove Config sheet handling from SpreadsheetContainer

**Completed**: SpreadsheetContainer no longer references config-sheet.ts or Config sheet type

**Key decisions**:
- Removed imports: parseConfigSheet, getSpecValues from config-sheet.ts
- Removed configSheet and parsedSpecs memos
- Removed beforeDeleteSheet/beforeUpdateSheetName hooks (no more Config protection)
- Removed sheet.type === 'config' checks in onChange handler
- Removed orange color styling for Config sheet
- Removed buildDataVerification and extractHeaders (dropdown building deferred to remove-config-3)
- processAutoSKU now passes empty specs array (to be fixed in sku-gen-2)
- Added TODO comments for remove-config-3 and sku-gen-2 follow-up tasks

**Files changed**:
- src/components/SpreadsheetContainer.tsx: Removed all Config sheet references
- src/components/SpreadsheetContainer.test.tsx: Updated tests for new behavior

---

## remove-config-1: Remove Config sheet from initialization

**Completed**: Config sheet no longer created on first launch; specs go to store

**Key decisions**:
- initializeWithSampleData() creates only Sample Products data sheet (no Config)
- getSampleSpecifications() returns Specification[] with Color/Size/Material
- Sample specs added directly to useSpecificationsStore on first launch
- onRehydrateStorage also updated to use new pattern
- Legacy createSampleSheets() kept with @deprecated for migration task

**Files changed**:
- src/lib/sample-data.ts: Added getSampleSpecifications(), createSampleProductSheet()
- src/store/sheets.ts: Updated initializeWithSampleData() and onRehydrateStorage
- src/lib/sample-data.test.ts: Added tests for getSampleSpecifications()
- src/store/sheets.test.ts: Updated tests for new behavior (no Config sheet)

---

## spec-store-3: Add skuFragment uniqueness validation

**Completed**: Added validateSkuFragment selector and enforced uniqueness

**Key decisions**:
- validateSkuFragment(specId, skuFragment, excludeValueId?) returns true if unique
- addSpecValue returns null if duplicate skuFragment in same spec
- updateSpecValue returns false if would create duplicate
- Different specs can share same skuFragment (Color:R and Size:R allowed)

**Files changed**:
- src/store/specifications.ts: Added validateSkuFragment, updated addSpecValue/updateSpecValue
- src/store/specifications.test.ts: Added 9 new tests for validation

---

## spec-store-2: Revive useSpecificationsStore as single source of truth

**Completed**: Store already fully implemented in spec-store-1

**Key decisions**:
- All requirements met: addSpecification, updateSpecification, removeSpecification, reorderSpec actions
- reorderSpec properly shifts other specs' orders for contiguity
- Persists to localStorage with key 'sku-specifications'
- 14 store tests all pass

**Files changed**: None (already complete from spec-store-1)

---

## spec-store-1: Update Specification type with order field

**Completed**: Updated data model types and specifications store

**Key decisions**:
- Renamed SpecValue fields: label→displayValue, skuCode→skuFragment (per PRD)
- Replaced Specification.columnIndex with order field
- Removed @deprecated markers from Specification/SpecValue (now primary interfaces)
- Store auto-assigns order=max+1 for new specs
- reorderSpec(specId, newOrder) shifts other specs' orders to maintain contiguity

**Files changed**:
- src/types/index.ts: Updated Specification & SpecValue interfaces
- src/store/specifications.ts: Removed deprecated status, added reorderSpec action
- src/store/specifications.test.ts: Updated tests for new field names, added reorderSpec tests
- src/lib/sku-generator.ts: Updated to use order/displayValue/skuFragment
- src/lib/sku-generator.test.ts: Updated test fixtures for new field names

**Notes**: Kept ParsedSpec/ParsedSpecValue/ConfigRow for backwards compat during migration
